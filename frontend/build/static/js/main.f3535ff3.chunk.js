(this["webpackJsonpmesto-react"]=this["webpackJsonpmesto-react"]||[]).push([[0],{20:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(22),s=n.n(i),c=(n(20),n(17)),r=n.n(c),l=n(27),u=n(23),p=n(2),d=n(3),j=n(24),h=n(25),b=new(function(){function e(t){var n=t.baseUrl,a=t.headers;Object(j.a)(this,e),this._baseUrl=n,this._headers=a}return Object(h.a)(e,[{key:"_getResponseData",value:function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}},{key:"getInitialCards",value:function(){return fetch(this._baseUrl+"/cards",{headers:{authorization:this._headers.authorization}}).then(this._getResponseData)}},{key:"getUserInfo",value:function(){var e=this._baseUrl+"/users/me";return fetch(e,{headers:{authorization:this._headers.authorization}}).then(this._getResponseData)}},{key:"editProfileInfo",value:function(e){return fetch(this._baseUrl+"/users/me",{method:"PATCH",headers:{authorization:this._headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(this._getResponseData)}},{key:"addCard",value:function(e){return fetch(this._baseUrl+"/cards",{method:"POST",headers:{authorization:this._headers.authorization,"Content-Type":"application/json"},body:JSON.stringify(e)}).then(this._getResponseData)}},{key:"editAvatar",value:function(e){return fetch(this._baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._getResponseData)}},{key:"addLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:{authorization:this._headers.authorization}}).then(this._getResponseData)}},{key:"deleteLike",value:function(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:{authorization:this._headers.authorization}}).then(this._getResponseData)}},{key:"changeLikeCardStatus",value:function(e,t){return!0===t?this.addLike(e):this.deleteLike(e)}},{key:"deleteCard",value:function(e){return fetch(this._baseUrl+"/cards/"+e,{method:"DELETE",headers:{authorization:this._headers.authorization}}).then(this._getResponseData)}}]),e}())({baseUrl:"https://api.nastish.nomoredomains.monster",headers:{authorization:"Bearer ".concat(localStorage.getItem("jwt")),"Content-Type":"application/json"}}),m=n.p+"static/media/logo.03b78ada.svg",f=n(8),_=n(0);var O=function(e){var t=e.userData,n=e.setLoggedIn,o=Object(d.h)(),i=Object(a.useState)({buttonName:"",buttonLink:""}),s=Object(p.a)(i,2),c=s[0],r=s[1],l=Object(a.useState)(""),u=Object(p.a)(l,2),j=u[0],h=u[1];return Object(a.useEffect)((function(){!function(){var e=o.pathname.split("/"),n=e[e.length-1];"sign-in"===n?(r({buttonName:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f",buttonLink:"/sign-up"}),h("")):"sign-up"===n?(r({buttonName:"\u0412\u043e\u0439\u0442\u0438",buttonLink:"/sign-in"}),h("")):(r({buttonName:"\u0412\u044b\u0439\u0442\u0438",buttonLink:"/sign-in"}),h(t))}()}),[o]),Object(_.jsxs)("header",{className:"header",children:[Object(_.jsx)("a",{href:"#",target:"_self",className:"header__link",children:Object(_.jsx)("img",{src:m,alt:"\u041b\u043e\u0433\u043e\u0442\u0438\u043f",className:"header__logo"})}),Object(_.jsxs)("div",{className:"header__nav",children:[Object(_.jsx)("p",{className:"header__mail",children:j}),Object(_.jsx)(f.b,{to:c.buttonLink,onClick:function(){"\u0412\u044b\u0439\u0442\u0438"===c.buttonName&&(localStorage.removeItem("jwt"),n(!1))},className:"header__action",children:c.buttonName})]})]})},v=o.a.createContext();var g=function(e){var t=e.card,n=e.onClick,o=e.onCardLike,i=e.onCardDelete,s=Object(a.useContext)(v),c=t.owner._id===s._id,r="card__delete ".concat(c?"card__delete-button_visible":"card__delete-button_hidden"),l=t.likes.some((function(e){return e===s._id})),u="card__like ".concat(l?"card__like_active":"");return Object(_.jsxs)("article",{className:"card",children:[Object(_.jsx)("button",{type:"button",className:r,onClick:function(){i(t)}}),Object(_.jsx)("img",{className:"card__photo",alt:t.name,src:t.link,onClick:function(){n(t)}}),Object(_.jsxs)("div",{className:"card__lists",children:[Object(_.jsx)("h2",{className:"card__title",children:t.name}),Object(_.jsxs)("div",{className:"card__like-box",children:[Object(_.jsx)("button",{type:"button",className:u,onClick:function(){o(t)}}),Object(_.jsx)("p",{className:"card__like-numb",children:t.likes.length})]})]})]})};var x=function(e){var t=e.userAvatar,n=e.onEditAvatar,a=e.userName,o=e.onEditProfile,i=e.userDescription,s=e.onAddPlace;return Object(_.jsxs)("section",{className:"profile",children:[Object(_.jsxs)("div",{className:"profile__box",children:[Object(_.jsx)("div",{className:"profile__avatar",style:{backgroundImage:"url(".concat(t)},children:Object(_.jsx)("button",{type:"button",className:"profile__avatar-overlay",onClick:n})}),Object(_.jsxs)("div",{className:"profile__info",children:[Object(_.jsxs)("div",{className:"profile__header",children:[Object(_.jsx)("h1",{className:"profile__title",children:a}),Object(_.jsx)("button",{type:"button",className:"profile__edit",id:"edit",onClick:o})]}),Object(_.jsx)("p",{className:"profile__text",children:i})]})]}),Object(_.jsx)("button",{type:"button",className:"profile__add",id:"add",onClick:s})]})};var C=function(e){var t=e.onAddPlace,n=e.onEditAvatar,o=e.onEditProfile,i=e.onCardClick,s=e.cards,c=e.onCardDelete,r=e.onCardLike,l=Object(a.useContext)(v);return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(x,{userAvatar:l.avatar,onEditAvatar:n,userName:l.name,onEditProfile:o,userDescription:l.about,onAddPlace:t}),Object(_.jsx)("section",{className:"cards",children:s.map((function(e){return Object(_.jsx)(g,{card:e,onClick:i,onCardLike:r,onCardDelete:c},e._id)}))})]})};var k=function(){return Object(_.jsx)("section",{className:"footer",children:Object(_.jsx)("p",{className:"footer__copyright",children:"\xa9\xa02021 Mesto Russia"})})};var N=function(e){return Object(_.jsx)("article",{className:e.isOpen?"popup popup_type_".concat(e.name," popup_opened"):"popup popup_type_".concat(e.name),onMouseUp:e.onClickClose,children:Object(_.jsxs)("div",{className:"popup__window",children:[Object(_.jsx)("button",{className:"popup__close",type:"button",onClick:e.onClose}),Object(_.jsxs)("form",{className:"form",name:"popup-form".concat(e.name),onSubmit:e.onSubmit,children:[Object(_.jsx)("h2",{className:"form__title",children:e.formTitle}),e.children,Object(_.jsx)("button",{className:"form__button",type:"submit",children:e.buttonTitle})]})]})})};var y=function(e){var t=e.card,n=e.onClose,a=e.onClickClose;return Object(_.jsx)("article",{className:"popup popup_type_image popup_opacity ".concat(null!=t?"popup_opened":""),onMouseUp:a,children:Object(_.jsxs)("div",{className:"popup__container",children:[Object(_.jsxs)("figure",{className:"popup__figure",children:[Object(_.jsx)("img",{src:null===t||void 0===t?void 0:t.link,alt:"\u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044f",className:"popup__photo"}),Object(_.jsxs)("figcaption",{className:"popup__caption",children:[null===t||void 0===t?void 0:t.name," "]})]}),Object(_.jsx)("button",{className:"popup__close",type:"button",onClick:n})]})})};var S=function(e){var t=e.isOpen,n=e.onClickClose,o=e.onClose,i=e.onUpdateUser,s=e.submitButton,c=Object(a.useContext)(v);Object(a.useEffect)((function(){d(c.name),m(c.about)}),[c,t]);var r=Object(a.useState)(""),l=Object(p.a)(r,2),u=l[0],d=l[1],j=Object(a.useState)(""),h=Object(p.a)(j,2),b=h[0],m=h[1];return Object(_.jsxs)(N,{name:"edit",buttonTitle:s,formTitle:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onSubmit:function(e){e.preventDefault(),i({name:u,about:b})},isOpen:t,onClose:o,onClickClose:n,children:[Object(_.jsx)("input",{className:"form__input form__input_name",id:"name",type:"text",name:"name",value:u||"",onChange:function(e){d(e.target.value)},placeholder:"\u0418\u043c\u044f",minLength:"2",maxLength:"40",required:!0}),Object(_.jsx)("span",{className:"form__input-error",id:"name-error"}),Object(_.jsx)("input",{className:"form__input form__input_about",id:"about",type:"text",name:"about",value:b||"",onChange:function(e){m(e.target.value)},placeholder:"\u041e \u0441\u0435\u0431\u0435",minLength:"2",maxLength:"200",required:!0}),Object(_.jsx)("span",{className:"form__input-error",id:"about-error"})]})};var L=function(e){var t=e.isOpen,n=e.onClose,o=e.onClickClose,i=e.onUpdateAvatar,s=e.submitButton,c=Object(a.useRef)();return Object(_.jsxs)(N,{name:"avatar",buttonTitle:s,formTitle:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",isOpen:t,onClose:n,onClickClose:o,onSubmit:function(e){e.preventDefault(),i({avatar:c.current.value}),c.current.value=""},children:[Object(_.jsx)("input",{className:"form__input form__input_link",id:"link",ref:c,type:"url",name:"avatar",defaultValue:"",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0444\u043e\u0442\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u044e",required:!0}),Object(_.jsx)("span",{className:"form__input-error",id:"link-error"})]})};var w=function(e){var t=e.isOpen,n=e.onClickClose,o=e.onClose,i=e.onAddPlace,s=e.submitButton,c=Object(a.useState)({value:""}),r=Object(p.a)(c,2),l=r[0],u=r[1],d=Object(a.useState)({value:""}),j=Object(p.a)(d,2),h=j[0],b=j[1];return Object(_.jsxs)(N,{name:"add",buttonTitle:s,formTitle:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",isOpen:t,onClose:o,onClickClose:n,onSubmit:function(e){e.preventDefault(),i({name:l.value,link:h.value}),u({value:""}),b({value:""})},children:[Object(_.jsx)("input",{className:"form__input form__input_title",id:"input-title",type:"text",name:"name",value:l.value,onChange:function(e){u({value:e.target.value})},placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",minLength:"2",maxLength:"30",required:!0}),Object(_.jsx)("span",{className:"form__input-error",id:"input-title-error"}),Object(_.jsx)("input",{className:"form__input form__input_link",id:"input-link",type:"url",name:"link",value:h.value,onChange:function(e){b({value:e.target.value})},placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0}),Object(_.jsx)("span",{className:"form__input-error",id:"input-link-error"})]})},z=n(11),P=n(9),T=function(e){var t=e.handleLogin,n=Object(a.useState)({email:"",password:""}),o=Object(p.a)(n,2),i=o[0],s=o[1],c=function(e){var t=e.target,n=t.name,a=t.value;s(Object(P.a)(Object(P.a)({},i),{},Object(z.a)({},n,a)))};return Object(_.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(i)},className:"authorization",children:[Object(_.jsx)("h2",{className:"authorization__title",children:"\u0412\u0445\u043e\u0434"}),Object(_.jsx)("input",{className:"authorization__input",name:"email",onChange:c,value:i.email,type:"email",placeholder:"Email",minLength:"2",required:!0}),Object(_.jsx)("input",{className:"authorization__input",name:"password",onChange:c,value:i.password,type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:"4",required:!0}),Object(_.jsx)("button",{className:"authorization__button",type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"})]})},E=function(e){var t=e.handleRegister,n=Object(a.useState)({email:"",password:""}),o=Object(p.a)(n,2),i=o[0],s=o[1],c=function(e){var t=e.target,n=t.name,a=t.value;s(Object(P.a)(Object(P.a)({},i),{},Object(z.a)({},n,a)))};return Object(_.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(i)},className:"authorization",children:[Object(_.jsx)("h2",{className:"authorization__title",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(_.jsx)("input",{className:"authorization__input",onChange:c,value:i.email,name:"email",type:"email",placeholder:"Email",minLength:"2",required:!0}),Object(_.jsx)("input",{className:"authorization__input",onChange:c,value:i.password,name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:"4",required:!0}),Object(_.jsx)("button",{className:"authorization__button",type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(_.jsxs)("p",{className:"authorization__text",children:["\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b? ",Object(_.jsx)(f.b,{to:"/sign-in",className:"authorization__link",children:"\u0412\u043e\u0439\u0442\u0438"})]})]})},D=n(28),U=function(e){var t=e.component,n=Object(D.a)(e,["component"]);return Object(_.jsx)(d.b,{children:function(){return!0===n.loggedIn?Object(_.jsx)(t,Object(P.a)({},n)):Object(_.jsx)(d.a,{to:"./sign-in"})}})},A=function(){return Object(_.jsx)("p",{children:"404 Page Not Found"})},I="https://api.nastish.nomoredomains.monster",R=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))},B=function(e){var t=e.isOpen,n=e.isConfirmed,a=e.onClickClose,o=e.onClose;return Object(_.jsx)("article",{className:"popup popup_type_status ".concat(t?"popup_opened":""),onMouseUp:a,children:Object(_.jsx)("div",{className:"popup__window",children:Object(_.jsxs)("form",{className:"form",children:[Object(_.jsx)("div",{className:"popup__picture ".concat(n?"popup__picture_good":"popup__picture_bad")}),Object(_.jsx)("p",{className:"popup__title popup__title_info",children:n?"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!":"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437."}),Object(_.jsx)("button",{className:"popup__close",type:"button",onClick:o})]})})})};var q=function(){var e=Object(a.useState)(!1),t=Object(p.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(!1),s=Object(p.a)(i,2),c=s[0],j=s[1],h=Object(a.useState)(!1),m=Object(p.a)(h,2),f=m[0],g=m[1],x=Object(a.useState)(null),z=Object(p.a)(x,2),P=z[0],D=z[1],q=Object(a.useState)({}),J=Object(p.a)(q,2),F=J[0],M=J[1],H=Object(a.useState)([]),G=Object(p.a)(H,2),V=G[0],K=G[1],Q=Object(a.useState)("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),W=Object(p.a)(Q,2),X=W[0],Y=W[1],Z=Object(a.useState)("\u0421\u043e\u0437\u0434\u0430\u0442\u044c"),$=Object(p.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)(!1),ae=Object(p.a)(ne,2),oe=ae[0],ie=ae[1],se=Object(a.useState)(""),ce=Object(p.a)(se,2),re=ce[0],le=ce[1],ue=Object(a.useState)({status:!1,isOpen:!1}),pe=Object(p.a)(ue,2),de=pe[0],je=pe[1],he=Object(d.g)();function be(){var e,t=localStorage.getItem("jwt");t&&(e=t,fetch("".concat(I,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(R)).then((function(e){e&&(ie(!0),le(e.data.email),he.push("/"))})).catch((function(e){return ve(e)}))}function me(){return(me=Object(u.a)(r.a.mark((function e(t){var n,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.likes.some((function(e){return e===F._id})),e.next=4,b.changeLikeCardStatus(t._id,!n);case 4:a=e.sent,o=V.map((function(e){return e._id===t._id?a:e})),K(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),ve(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function fe(){j(!1),o(!1),g(!1),D(null),je(!1)}Object(a.useEffect)((function(){be(),Promise.all([b.getUserInfo(),b.getInitialCards()]).then((function(e){M(e[0]),K(e[1])})).catch((function(e){ve(e),M({})}))}),[]);var _e=function(e){e.target.classList.contains("popup_opened")&&fe()};function Oe(e){var t=e.flag;"profile"===e.popup?Y(t?"\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435...":"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"):te(t?"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435...":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")}function ve(e){console.log("Error: "+e)}return Object(a.useEffect)((function(){var e=function(e){"Escape"===e.key&&fe()};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}})),Object(_.jsx)(v.Provider,{value:F,children:Object(_.jsx)("div",{className:"container",children:Object(_.jsxs)("div",{className:"page",children:[Object(_.jsx)(O,{userData:re,setLoggedIn:ie}),Object(_.jsxs)(d.d,{children:[Object(_.jsx)(U,{exact:!0,path:"/",loggedIn:oe,component:C,onEditProfile:function(){g(!f)},onAddPlace:function(){j(!c)},onEditAvatar:function(){o(!n)},onCardClick:D,cards:V,onCardLike:function(e){return me.apply(this,arguments)},onCardDelete:function(e){b.deleteCard(e._id).then((function(t){var n=V.filter((function(t){return t._id!==e._id}));K(n),console.log(t)})).catch(ve)}}),Object(_.jsx)(d.b,{path:"/sign-in",children:Object(_.jsx)(T,{handleLogin:function(e){(function(e){var t=e.email,n=e.password;return fetch("".concat(I,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:n,email:t})}).then(R)})(e).then((function(t){console.log(t),t.token&&(localStorage.setItem("jwt",t.token),le(e.email),ie(!0),he.push("/"))})).catch((function(e){console.log(e),je({status:!1,isOpen:!0})}))},tokenCheck:be})}),Object(_.jsx)(d.b,{path:"/sign-up",children:Object(_.jsx)(E,{handleRegister:function(e){(function(e){var t=e.email,n=e.password;return fetch("".concat(I,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:n,email:t})}).then(R)})(e).then((function(e){console.log(e),je({status:!0,isOpen:!0}),he.push("/sign-in")})).catch((function(e){console.log(e),je({status:!1,isOpen:!0})}))}})}),Object(_.jsx)(U,{path:"*",component:A})]}),Object(_.jsx)(B,{isOpen:de.isOpen,isConfirmed:de.status,onClose:fe,onClickClose:_e}),Object(_.jsx)(w,{isOpen:c,onClose:fe,onClickClose:_e,onAddPlace:function(e){Oe({flag:!0,popup:"addPlace"}),console.log(e),b.addCard(e).then((function(e){K([e].concat(Object(l.a)(V))),fe()})).catch(ve).finally((function(){Oe({flag:!1,popup:"addPlace"})}))},submitButton:ee}),Object(_.jsx)(S,{isOpen:f,onClose:fe,onClickClose:_e,onUpdateUser:function(e){Oe({flag:!0,popup:"profile"}),b.editProfileInfo(e).then((function(e){M(e),fe()})).catch(ve).finally((function(){Oe({flag:!1,popup:"profile"})}))},submitButton:X}),Object(_.jsx)(L,{isOpen:n,onClickClose:_e,onClose:fe,onUpdateAvatar:function(e){Oe({flag:!0,popup:"avatar"}),b.editAvatar(e).then((function(e){M(e),fe()})).catch(ve).finally((function(){Oe({flag:!1,popup:"avatar"})}))},submitButton:ee}),Object(_.jsx)(y,{card:P,onClose:fe,onClickClose:_e}),Object(_.jsx)(N,{name:"delete",buttonTitle:"\u0414\u0430",formTitle:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",isOpen:!1}),Object(_.jsx)(k,{})]})})})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,41)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),a(e),o(e),i(e),s(e)}))};s.a.render(Object(_.jsx)(o.a.StrictMode,{children:Object(_.jsx)(f.a,{children:Object(_.jsx)(q,{})})}),document.getElementById("root")),J()}},[[40,1,2]]]);
//# sourceMappingURL=main.f3535ff3.chunk.js.map